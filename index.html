<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>2Д-гра шашки рейсінг</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #111;
    overflow: hidden;
    touch-action: none;
}
canvas {
    display: block;
    margin: auto;
    background: #555;
}
#ui {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 20px;
}
#menu, #over {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,.85);
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
button {
    font-size: 20px;
    padding: 15px 30px;
    border-radius: 12px;
    border: none;
}
#controls {
    position: absolute;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
}
.ctrl {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    border: 2px solid white;
    color: white;
    font-size: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    touch-action: none;
    pointer-events: auto;
}
</style>
</head>
<body>
<div id="menu">
    <h1>Гоночна гра</h1>
    <button id="startBtn">Старт</button>
</div>
<div id="over" style="display:none">
    <h1>Ви врізались в автомобіль.Нажаль,для вас гра закінчена(</h1>
    <p id="finalScore"></p>
    <button id="restartBtn">Почати знову</button>
</div>
<div id="ui">Ваші очки: 0</div>

<div id="controls" style="display:none">
    <div class="ctrl" id="left">←</div>
    <div class="ctrl" id="right">→</div>
</div>

<canvas id="game" width="360" height="600"></canvas>
    
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let player, enemies, score, speed;
let running = false;
let enemyTimer = 0;

let moveLeft = false;
let moveRight = false;

document.body.addEventListener("touchmove", e => e.preventDefault(), { passive:false });

const leftBtn = document.getElementById("left");
const rightBtn = document.getElementById("right");

leftBtn.addEventListener("pointerdown", e => { e.preventDefault(); moveLeft = true; });
leftBtn.addEventListener("pointerup", () => moveLeft = false);
leftBtn.addEventListener("pointerleave", () => moveLeft = false);

rightBtn.addEventListener("pointerdown", e => { e.preventDefault(); moveRight = true; });
rightBtn.addEventListener("pointerup", () => moveRight = false);
rightBtn.addEventListener("pointerleave", () => moveRight = false);

document.addEventListener("pointercancel", () => {
    moveLeft = false;
    moveRight = false;
});
document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") moveLeft = true;
    if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") moveRight = true;
});
document.addEventListener("keyup", e => {
    if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") moveLeft = false;
    if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") moveRight = false;
});
document.getElementById("startBtn").onclick = startGame;
document.getElementById("restartBtn").onclick = startGame;

function startGame() {
    player = { x: 160, y: 470, w: 40, h: 80 };
    enemies = [];
    score = 0;
    speed = 3;
    enemyTimer = 0;
    running = true;

    moveLeft = false;
    moveRight = false;

    document.getElementById("menu").style.display = "none";
    document.getElementById("over").style.display = "none";
    document.getElementById("controls").style.display = "flex";
    document.getElementById("ui").innerText = "Очки: 0";

    requestAnimationFrame(gameLoop);
}
function gameLoop() {
    if (!running) return;

    drawRoad();
    updatePlayer();
    drawPlayer();
    updateEnemies();

    requestAnimationFrame(gameLoop);
}
function drawRoad() {
    ctx.fillStyle = "#555";
    ctx.fillRect(0,0,360,600);

    ctx.strokeStyle = "white";
    ctx.lineWidth = 4;
    ctx.setLineDash([30,20]);
    ctx.beginPath();
    ctx.moveTo(120,0); ctx.lineTo(120,600);
    ctx.moveTo(240,0); ctx.lineTo(240,600);
    ctx.stroke();
}
function updatePlayer() {
    if (moveLeft) player.x -= 6;
    if (moveRight) player.x += 6;

    player.x = Math.max(20, Math.min(player.x, 300));
}
function drawPlayer() {
    drawCar(player.x, player.y, "#00eaff");
}
function updateEnemies() {
    enemyTimer++;
    if (enemyTimer > 50) {
        spawnEnemy();
        enemyTimer = 0;
    }
    for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        e.y += speed;
        drawCar(e.x, e.y, "#ff4040");

        if (e.y > 600) {
            enemies.splice(i,1);
            score++;
            speed += 0.05;
            document.getElementById("ui").innerText = "Очки: " + score;
        }

        if (checkHit(player, e)) endGame();
    }
}
function spawnEnemy() {
    const lane = Math.floor(Math.random() * 3);
    enemies.push({
        x: lane * 120 + 60,
        y: -100,
        w: 40,
        h: 80
    });
}
function drawCar(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, 40, 80);

    ctx.fillStyle = "#222";
    ctx.fillRect(x + 5, y + 10, 30, 20);
    ctx.fillRect(x + 5, y + 45, 30, 20);
}
function checkHit(a, b) {
    return a.x < b.x + b.w &&
           a.x + a.w > b.x &&
           a.y < b.y + b.h &&
           a.y + a.h > b.y;
}
function endGame() {
    running = false;
    document.getElementById("controls").style.display = "none";
    document.getElementById("finalScore").innerText = "Очки: " + score;
    document.getElementById("over").style.display = "flex";
}
</script>
</body>
</html>
